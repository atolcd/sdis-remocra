= SDIS Remocra - Manuel d'exploitation V2

ifdef::env-github,env-browser[:outfilesuffix: .adoc]

:experimental:
:icons: font

:toc:

:numbered:

link:../index{outfilesuffix}[Retour à l'accueil]

'''
== Services système

Manipulation des services disponibles :

[source,sh]
----
# PostgeSQL
systemctl stop postgresql
systemctl status postgresql
systemctl start postgresql
systemctl restart postgresql

# Docker
systemctl stop docker
systemctl status docker
systemctl start docker
systemctl restart docker

----
== Manipulation des images docker:

[source,sh]
----
docker ps
docker stop <image>
docker start <image>
docker restart <image>
docker logs <image>

----
== Journaux

=== Localisation des journaux

Les fichiers journaux intéressants sont les suivants.

* *PostgreSQL*
** /var/log/postgresql/postgresql-11-main.log

* *Remocra*
** docker logs remocra
** /var/remocra/log

* *GeoServer*
** docker logs geoserver
** /var/remocra/geoserver_data/logs

* *PDI*
** docker logs pdi
** /var/remocra/pdi/log

== Mise à jour des conteneurs
[source,sh]
----
docker stop $(docker ps -a -q)

----
* Modifier le numéro de version dans le fichier /etc/docker_remocra/.env (ou /etc/remocra/.env).
(Si le fichier .env n'existe pas, éditer le fichier remocra.env ou inversement)

[source,sh]
----
REMOCRA_VERSION="2.1.6"
----

* Jouer les patches sql au cas de mise à jour de la base:

[source,sh]
----
Ex: `PVERSION=103 && psql -h localhost -d remocra -f "/home/postgres/remocra_db/patches/$PVERSION/$PVERSION.sql"`
----

* Redémarrer les images docker

[source,sh]
----
docker-compose up -d
----

== Jobs pdi
* Un dashboard dkron est accessible sur les urls:
** http://localhost:8070/dashboard/
** http://localhost:8060/dashboard/

